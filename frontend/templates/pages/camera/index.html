{% extends "base.html" %} {% block content %}
<!-- Skeleton Loader -->
<div id="skeleton-loader-container" class="w-full h-screen bg-white">
  <div
    id="skeleton-loader"
    class="grid grid-cols-1 lg:grid-cols-2 gap-4 animate-pulse p-4"
  >
    <!-- Left: Deposit Overview Placeholder -->
    <div class="space-y-4">
      <!-- Title Placeholder -->
      <div class="h-6 w-1/3 bg-gray-300 rounded"></div>

      <!-- KPI Cards -->
      <div class="grid grid-cols-3 gap-3">
        <div class="h-24 bg-gray-200 rounded-lg"></div>
        <div class="h-24 bg-gray-200 rounded-lg"></div>
        <div class="h-24 bg-gray-200 rounded-lg"></div>
      </div>

      <!-- Deposit Log Placeholder -->
      <div class="h-[calc(100vh-250px)] bg-gray-200 rounded-lg"></div>
    </div>

    <!-- Right: Charts Placeholder -->
    <div class="space-y-4">
      <div
        class="h-64 bg-gray-200 rounded-lg flex flex-col justify-center items-center"
      >
        <div class="h-6 w-1/4 bg-gray-300 rounded mb-2"></div>
        <div class="h-40 w-11/12 bg-gray-300 rounded"></div>
      </div>
      <div
        class="h-64 bg-gray-200 rounded-lg flex flex-col justify-center items-center"
      >
        <div class="h-6 w-1/4 bg-gray-300 rounded mb-2"></div>
        <div class="h-40 w-11/12 bg-gray-300 rounded"></div>
      </div>
    </div>
  </div>
</div>
<!-- Main Dashboard Grid -->
<div
  id="mdh"
  class="grid grid-cols-1 lg:grid-cols-2 gap-4 p-0 md:p-4 w-full items-stretch min-h-[calc(100vh-100px)] hidden"
>
  <!-- ğŸ”´ Live Camera Feed Section -->
  <div
    id="cameraPage"
    class="flex flex-col p-1 md:p-6 bg-white rounded-2xl shadow-lg border border-gray-200 h-full"
  >
    <div class="flex items-center justify-center gap-2 mb-4 w-full">
      <i data-lucide="camera" class="w-6 h-6 text-blue-600"></i>
      <h2 class="text-2xl font-semibold text-gray-800">Live Camera Feed</h2>
    </div>

    <div
      id="camera-wrapper"
      class="relative w-full max-w-[23rem] mx-auto aspect-[3/4] bg-black rounded-xl overflow-hidden border border-gray-300 shadow-sm"
    >
      <video
        id="video"
        class="absolute inset-0 w-full h-full object-cover z-10"
        autoplay
        playsinline
        muted
      ></video>
      <canvas id="overlay" class="absolute inset-0 z-20"></canvas>
    </div>
    <canvas id="canvas" class="hidden"></canvas>

    <span class="text-red-500 p-2" id="face_position"></span>
    <button
      disabled
      id="capture"
      class="mt-2 w-full px-6 py-3 bg-green-600 text-white rounded-xl text-lg font-semibold shadow hover:bg-green-700 hover:scale-105 active:scale-95 transition-transform duration-200"
    >
      Capture
    </button>
  </div>

  <!-- Preview Page -->
  <div id="previewPage" class="hidden">
    <img id="previewImage" class="rounded-lg border shadow-lg" />
    <div class="mt-4 flex gap-4">
      <button id="tryAgain" class="px-4 py-2 bg-gray-400 text-white rounded-lg">
        ğŸ”„ Try Again
      </button>
      <button id="submit" class="px-4 py-2 bg-green-500 text-white rounded-lg">
        âœ… Next
      </button>
    </div>
  </div>

  <!-- Capture Loader for face -->
  <div
    id="captureLoader"
    class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm z-50 transition-opacity duration-300"
  >
    <div
      class="bg-gray-900 px-6 py-5 rounded-2xl shadow-lg flex flex-col items-center space-y-4 w-72"
    >
      <!-- Spinner -->
      <div
        class="w-14 h-14 border-4 border-blue-400 border-t-transparent rounded-full animate-spin shadow-md"
      ></div>
      <!-- Text -->
      <p class="text-gray-100 text-lg font-medium tracking-wide">
        Processing your image...
      </p>
      <!-- Subtext -->
      <p class="text-gray-400 text-sm">
        Please wait, this may take a few seconds.
      </p>
    </div>
  </div>

  <!-- ID Capture Page -->
  <div id="idCapturePage" class="hidden">
    <div class="flex flex-col items-center">
      <h2 id="idCaptureTitle" class="text-xl font-semibold mb-4">Capture Front of ID</h2>
      <div class="relative w-full max-w-[23rem] mx-auto aspect-[3/4] bg-black rounded-xl overflow-hidden border border-gray-300 shadow-sm">
        <video id="idVideo" class="absolute inset-0 w-full h-full object-cover z-10" autoplay playsinline muted></video>
        <canvas id="idOverlay" class="absolute inset-0 z-20"></canvas>
      </div>
      <canvas id="idCanvas" class="hidden"></canvas>
      <button id="switchCamera" class="p-2 bg-gray-700 text-white rounded">ğŸ”„ Switch Camera</button>
      <button id="captureID" class="mt-4 px-6 py-3 bg-green-600 text-white rounded-xl text-lg font-semibold shadow hover:bg-green-700">ğŸ“· Capture ID</button>
    </div>
  </div>

  <!-- Final Review Page -->
  <div id="finalReviewPage" class="hidden p-4">
    <h2 class="text-xl font-bold mb-4">Review Your Captures</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <h3>Face</h3>
        <img id="reviewFace" class="w-full rounded-lg border shadow" />
        <button id="retryFace" class="mt-2 px-3 py-2 bg-yellow-500 text-white rounded">ğŸ”„ Retry</button>
      </div>
      <div>
        <h3>ID Front</h3>
        <img id="reviewFront" class="w-full rounded-lg border shadow" />
        <button id="retryFront" class="mt-2 px-3 py-2 bg-yellow-500 text-white rounded">ğŸ”„ Retry</button>
      </div>
      <div>
        <h3>ID Back</h3>
        <img id="reviewBack" class="w-full rounded-lg border shadow" />
        <button id="retryBack" class="mt-2 px-3 py-2 bg-yellow-500 text-white rounded">ğŸ”„ Retry</button>
      </div>
    </div>
    <button id="finalSubmit" class="mt-4 px-6 py-3 bg-green-600 text-white rounded-xl text-lg font-semibold shadow hover:bg-green-700">âœ… Submit All</button>
  </div>


  <!-- ğŸŸ¢ Encoded Image Gallery Section -->
  <!-- <div
    class="flex flex-col p-6 bg-white rounded-2xl shadow-lg border border-gray-200 h-full"
  >
    <div class="flex items-center gap-2 mb-4">
      <i data-lucide="image-down" class="w-6 h-6 text-green-600"></i>
      <h2 class="text-2xl font-semibold text-gray-800">
        Encoded Image Gallery
      </h2>
    </div>

    <span class="text-sm text-red-600 mb-2">For Testing</span>

    <div
      id="encodedGalleryWrapper"
      class="max-h-[300px] overflow-y-auto border border-gray-300 rounded-xl p-3 bg-gray-50 shadow-inner"
    >
      <div
        id="encodedGallery"
        class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4"
      >
        
      </div>
    </div>

    <button
      id="decodeBtnGallery"
      class="hidden w-full px-6 py-3 mt-6 bg-green-600 text-white rounded-xl text-lg font-semibold shadow hover:bg-green-700 hover:scale-105 active:scale-95 transition-transform duration-200"
    >
      ğŸ” Decode Selected Image
    </button>

    <p
      id="decodedMessageGallery"
      class="text-center mt-4 text-base text-gray-800 font-mono break-words whitespace-pre-wrap px-2"
    ></p>
  </div> -->
</div>

<!-- Scrollbar + Thumbnail Hover Effects -->
<style>
  #encodedGalleryWrapper::-webkit-scrollbar {
    width: 6px;
  }
  #encodedGalleryWrapper::-webkit-scrollbar-thumb {
    background-color: rgba(100, 100, 100, 0.2);
    border-radius: 4px;
  }
  #encodedGallery img {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  #encodedGallery img:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
  #encodedGallery img:active {
    transform: scale(0.95);
  }
  #video,
  #overlay {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    border-radius: 1rem;
  }
</style>

<!-- âœ… Face + Camera Scripts -->
<script src="/static/js/face-api.js?v=2"></script>
<script src="/static/js/camerav2.js?v=10"></script>
{% endblock %}
